{% extends 'base.html' %}

{% block title %}Project Job Description{% endblock %}

{% block page_title %}Project Job Description{% endblock %}

{% block top_links_menu %}
<a href="/projects">Back to Projects</a>
{% endblock %}

{% block content %}
<div class="project-job-description-page">
    <h1>Project Job Description - {{ project[1] }}</h1>
    
    <form method="POST" action="/project_job_description/{{ project[0] }}">
        <h2>Position Details</h2>
        
        <div class="form-group">
            <label for="about_organisation">
                About the organisation - Max 
                <input type="number" id="about_org_word_limit" name="about_org_word_limit" 
                       value="{{ project[13] if project[13] else 70 }}" 
                       min="1" style="width: 60px; display: inline-block; padding: 2px;">
                words 
                {% if project[14] %}
                    ({{ project[14] }})
                {% else %}
                    ({{ current_date }})
                {% endif %}
                <a href="#" onclick="window.open('https://feit-vocational-placement.app.unimelb.edu.au/index.php?r=request/createInternship&id=0m', '_blank')" title="External link">Link*</a>
            </label>
            <textarea class="form-control" id="about_organisation" name="about_organisation" rows="5" placeholder="Describe the organization...">{{ project[9] if project[9] else '' }}</textarea>
            <small class="form-text text-muted">
                Word count: <span id="org_word_count">0</span>/<span id="org_word_limit_display">{{ project[13] if project[13] else 70 }}</span>
                <span id="org_word_warning" style="color: red; display: none;">Word limit exceeded!</span>
            </small>
        </div>
        
        <div class="form-group">
            <label for="position_title">Position Title</label>
            <input type="text" class="form-control" id="position_title" name="position_title" placeholder="Enter the position title..." value="{{ project[10] if project[10] else '' }}">
        </div>

        <div class="form-group">
            <label for="position_description">
                Position Description - Duties and Responsibilities 
                (<input type="number" id="position_desc_word_min" name="position_desc_word_min" 
                        value="{{ project[15] if project[15] else 400 }}" 
                        min="1" style="width: 60px; display: inline-block; padding: 2px;"> 
                word minimum to 
                <input type="number" id="position_desc_word_max" name="position_desc_word_max" 
                       value="{{ project[16] if project[16] else 500 }}" 
                       min="1" style="width: 60px; display: inline-block; padding: 2px;"> 
                word maximum) 
                {% if project[17] %}
                    ({{ project[17] }}) 
                {% else %}
                    ({{ current_date }}) 
                {% endif %}*
            </label>
            <textarea class="form-control" id="position_description" name="position_description" rows="5" placeholder="Describe the position duties and responsibilities...">{{ project[11] if project[11] else '' }}</textarea>
            <small class="form-text text-muted">
                Word count: <span id="position_word_count">0</span> 
                (Min: <span id="position_min_display">{{ project[15] if project[15] else 400 }}</span>, 
                Max: <span id="position_max_display">{{ project[16] if project[16] else 500 }}</span>)
                <span id="position_word_warning" style="color: red; display: none;">Word count outside range!</span>
            </small>
        </div>

        <div class="form-group">
            <label for="skill_requirements">
                What are the key skills you anticipate students will develop whilst undertaking the internship? 
                (<input type="number" id="skills_word_min" name="skills_word_min" 
                        value="{{ project[18] if project[18] else 50 }}" 
                        min="1" style="width: 60px; display: inline-block; padding: 2px;"> 
                word minimum to 
                <input type="number" id="skills_word_max" name="skills_word_max" 
                       value="{{ project[20] if project[20] else 70 }}" 
                       min="1" style="width: 60px; display: inline-block; padding: 2px;"> 
                word maximum) 
                {% if project[19] %}
                    ({{ project[19] }})
                {% else %}
                    ({{ current_date }})
                {% endif %}
            </label>
            <textarea class="form-control" id="skill_requirements" name="skill_requirements" rows="5" placeholder="List the key skills students will develop...">{{ project[12] if project[12] else '' }}</textarea>
            <small class="form-text text-muted">
                Word count: <span id="skill_word_count">0</span> 
                (Min: <span id="skills_min_display">{{ project[18] if project[18] else 50 }}</span>, 
                Max: <span id="skills_max_display">{{ project[20] if project[20] else 70 }}</span>)
                <span id="skills_word_warning" style="color: red; display: none;">Word count outside range!</span>
            </small>
        </div>

        <button type="submit" class="btn btn-primary">Save Description</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    function countWords(text) {
        return text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
    }
    
    function updateWordCount(textareaId, counterId, maxWords = null, warningId = null) {
        const textarea = document.getElementById(textareaId);
        const counter = document.getElementById(counterId);
        const warning = warningId ? document.getElementById(warningId) : null;
        
        function update() {
            const wordCount = countWords(textarea.value);
            counter.textContent = wordCount;
            
            if (maxWords && warning) {
                if (wordCount > maxWords) {
                    warning.style.display = 'inline';
                    counter.style.color = 'red';
                } else {
                    warning.style.display = 'none';
                    counter.style.color = '#666';
                }
            }
        }
        
        // Update on input
        textarea.addEventListener('input', update);
        
        // Initial count
        update();
    }
    
    function updateDynamicWordCount(textareaId, counterId, limitInputId, limitDisplayId, warningId) {
        const textarea = document.getElementById(textareaId);
        const counter = document.getElementById(counterId);
        const limitInput = document.getElementById(limitInputId);
        const limitDisplay = document.getElementById(limitDisplayId);
        const warning = document.getElementById(warningId);
        
        function update() {
            const wordCount = countWords(textarea.value);
            const maxWords = parseInt(limitInput.value) || 70;
            
            counter.textContent = wordCount;
            limitDisplay.textContent = maxWords;
            
            if (wordCount > maxWords) {
                warning.style.display = 'inline';
                counter.style.color = 'red';
            } else {
                warning.style.display = 'none';
                counter.style.color = '#666';
            }
        }
        
        // Update on textarea input
        textarea.addEventListener('input', update);
        
        // Update when limit changes
        limitInput.addEventListener('input', function() {
            update();
        });
        
        // Initial count
        update();
    }
    
    function updateDynamicWordCountRange(textareaId, counterId, minInputId, maxInputId, minDisplayId, maxDisplayId, warningId) {
        const textarea = document.getElementById(textareaId);
        const counter = document.getElementById(counterId);
        const minInput = document.getElementById(minInputId);
        const maxInput = document.getElementById(maxInputId);
        const minDisplay = document.getElementById(minDisplayId);
        const maxDisplay = document.getElementById(maxDisplayId);
        const warning = document.getElementById(warningId);
        
        function update() {
            const wordCount = countWords(textarea.value);
            const minWords = parseInt(minInput.value) || 0;
            const maxWords = parseInt(maxInput.value) || 1000;
            
            counter.textContent = wordCount;
            minDisplay.textContent = minWords;
            maxDisplay.textContent = maxWords;
            
            if (wordCount < minWords || wordCount > maxWords) {
                warning.style.display = 'inline';
                counter.style.color = 'red';
            } else {
                warning.style.display = 'none';
                counter.style.color = '#666';
            }
        }
        
        // Update on textarea input
        textarea.addEventListener('input', update);
        
        // Update when limits change
        minInput.addEventListener('input', update);
        maxInput.addEventListener('input', update);
        
        // Initial count
        update();
    }
    
    function updateDynamicWordCountMin(textareaId, counterId, minInputId, minDisplayId, warningId) {
        const textarea = document.getElementById(textareaId);
        const counter = document.getElementById(counterId);
        const minInput = document.getElementById(minInputId);
        const minDisplay = document.getElementById(minDisplayId);
        const warning = document.getElementById(warningId);
        
        function update() {
            const wordCount = countWords(textarea.value);
            const minWords = parseInt(minInput.value) || 0;
            
            counter.textContent = wordCount;
            minDisplay.textContent = minWords;
            
            if (wordCount < minWords) {
                warning.style.display = 'inline';
                counter.style.color = 'red';
            } else {
                warning.style.display = 'none';
                counter.style.color = '#666';
            }
        }
        
        // Update on textarea input
        textarea.addEventListener('input', update);
        
        // Update when limit changes
        minInput.addEventListener('input', update);
        
        // Initial count
        update();
    }
    
    $(document).ready(function() {
        // About Organisation - with dynamic word limit AND warning
        updateDynamicWordCount('about_organisation', 'org_word_count', 'about_org_word_limit', 'org_word_limit_display', 'org_word_warning');
        
        // Position Description - with min/max range
        updateDynamicWordCountRange('position_description', 'position_word_count', 'position_desc_word_min', 'position_desc_word_max', 'position_min_display', 'position_max_display', 'position_word_warning');
        
        // Skill Requirements - with min/max range  
        updateDynamicWordCountRange('skill_requirements', 'skill_word_count', 'skills_word_min', 'skills_word_max', 'skills_min_display', 'skills_max_display', 'skills_word_warning');
    });
</script>
{% endblock %}
