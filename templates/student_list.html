{% extends 'base.html' %}

{% block title %}Student List{% endblock %}

{% block page_title %}List of Students{% endblock %}

{% block content %}
    <h1>List of Students</h1>

    <form method="POST" action="{{ url_for('student_list') }}">
        <label for="intake">Filter by Intake:</label>
        <select name="intake" id="intake">
            <option value="">All Intakes</option>
            {% for intake in intakes %}
                <option value="{{ intake[0] }}" {% if intake[0] == request.form.get('intake') %}selected{% endif %}>{{ intake[0] }}</option>
            {% endfor %}
        </select>

        <label for="project">Filter by Project:</label>
        <select name="project" id="project">
            <option value="">All Projects</option>
            {% for project in projects %}
                <option value="{{ project[1] }}" {% if project[1] == request.form.get('project') %}selected{% endif %}>{{ project[1] }}</option>
            {% endfor %}
        </select>

        <label for="status">Filter by Status:</label>
        <select name="status" id="status">
            <option value="">All Statuses</option>
            {% for status in statuses %}
                <option value="{{ status[0] }}" {% if status[0] == request.form.get('status') %}selected{% endif %}>{{ status[0] }}</option>
            {% endfor %}
        </select>

        <label for="course">Filter by Course:</label>
        <select name="course" id="course">
            <option value="">All Courses</option>
            {% for course in courses %}
                <option value="{{ course[0] }}" {% if course[0] == request.form.get('course') %}selected{% endif %}>{{ course[0] }}</option>
            {% endfor %}
        </select>

        <button type="submit">Filter</button>
    </form>

    <!-- Add the Copy Email Buttons-->
    <div style="margin-top: 20px;">
        <button onclick="copyEmails('personal_email')">Copy Personal Emails</button>
        <button onclick="copyEmails('wehi_email')">Copy WEHI Emails</button>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Pronunciation</th>
                <th>Pronouns</th>
                <th data-email-type="personal_email">Personal Email</th>
                <th data-email-type="wehi_email">WEHI Email</th>
                <th>Mobile</th>
                <th>Project</th>
                <th>Intake</th>
                <th>Course</th>
                <th>Status</th>
                <th>Pre Internship Summary</th>
                <th>Post Internship Rating</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
                <tr>
                    <td>{{ student[0] }}</td>
                    <td>{{ student[1] }}</td>
                    <td>{{ student[2] }}</td>
                    <td>{{ student[3] }}</td>
                    <td data-email-type="personal_email">{{ student[4] }}</td> <!-- Personal Email -->
                    <td data-email-type="wehi_email">{{ student[5] }}</td> <!-- WEHI Email -->
                    <td>{{ student[6] }}</td>
                    <td>{{ student[7] }}</td>
                    <td>{{ student[8] }}</td>
                    <td>{{ student[9] }}</td>
                    <td>{{ student[10] }}</td>
                    <td>{{ student[11] }}</td>
                    <td>{{ student[12] }}</td>
                    <td><a href="/view/{{ student[0] }}">View</a> | <a href="/edit/{{ student[0] }}">Edit</a></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- JavaScript function for copying emails -->
    <script>
    function copyEmails(emailType) {
        let emails = [];
        document.querySelectorAll(`td[data-email-type="${emailType}"]`).forEach(td => {
            emails.push(td.innerText.trim());
        });
        let emailsString = emails.join('; ');
        navigator.clipboard.writeText(emailsString).then(() => {
            alert('Emails copied to clipboard!');
        });
    }
    </script>

{% endblock %}
